<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Raspberry Pi ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¬ë°</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin-top: 30px; }
    img { border: 2px solid #333; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>ğŸ“· ì‹¤ì‹œê°„ ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¬ë° (WebSocket)</h2>
  <img id="video" width="640" height="480" alt="ìŠ¤íŠ¸ë¦¬ë° ì˜ìƒ" />
  <p id="status">ğŸ”„ ì—°ê²° ì¤‘...</p>

  <script>
    const img = document.getElementById('video');
    const status = document.getElementById('status');
    let ws;

    function connectWebSocket() {
      ws = new WebSocket('ws://' + location.hostname + ':8765/');

      ws.onopen = () => {
        console.log('âœ… WebSocket ì—°ê²° ì„±ê³µ');
        status.textContent = 'âœ… ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì¤‘';
      };

      ws.onmessage = ev => {
        img.src = 'data:image/jpeg;base64,' + ev.data;
      };

      ws.onclose = () => {
        console.warn('âŒ WebSocket ì—°ê²° ì¢…ë£Œë¨. ì¬ì—°ê²° ì‹œë„ ì¤‘...');
        status.textContent = 'ğŸ” ì—°ê²° ëŠê¹€, ì¬ì‹œë„ ì¤‘...';
        setTimeout(connectWebSocket, 2000);
      };

      ws.onerror = err => {
        console.error('âš ï¸ WebSocket ì˜¤ë¥˜:', err);
        status.textContent = 'âš ï¸ ì—°ê²° ì˜¤ë¥˜ ë°œìƒ';
        ws.close();
      };
    }

    connectWebSocket();
  </script>
</body>
</html>
